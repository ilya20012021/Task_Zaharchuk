<h1 id="поиск-утечки-данных-из-сети">Поиск утечки данных из сети</h1>
<p>Илья Москалёв</p>
<h2 id="задание-4-обнаружение-канала-управления">Задание 4: Обнаружение
канала управления</h2>
<p>Зачастую в корпоротивных сетях находятся ранее зараженные системы,
компрометация которых оста- лась незамеченной. Такие системы генерируют
небольшое количество трафика для связи с панелью управ- ления бот-сети,
но с одинаковыми параметрами – в данном случае с одинаковым номером
порта. Какой номер порта используется бот-панелью для управления
ботами?</p>
<h2 id="ход-работы">Ход работы</h2>
<p>Переведём полученный дамп трафика в датафрейм Pandas:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> read_csv(<span class="st">&quot;./traffic_security.csv&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> df.iloc[::,<span class="dv">1</span>]</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> []</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df1)):</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  t <span class="op">=</span> df1[i]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  r <span class="op">=</span> <span class="bu">list</span>(t)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  v <span class="op">=</span> []</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> j <span class="kw">in</span> r:</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> j <span class="op">!=</span> <span class="st">&quot;.&quot;</span>:</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      v.append(j)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  z <span class="op">=</span> <span class="st">&quot;&quot;</span>.join(v)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  b.append(z)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  v.clear()</span></code></pre></div>
<p>Определим внутренние узлы:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> DataFrame({<span class="st">&quot;first_num_ip&quot;</span>:b})</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> df2[df2[<span class="st">&quot;first_num_ip&quot;</span>].isin([<span class="st">&quot;12&quot;</span>,<span class="st">&quot;13&quot;</span>,<span class="st">&quot;14&quot;</span>])]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df4 <span class="op">=</span> []</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df3.index:</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    df4.append(i)</span></code></pre></div>
<p>Получим ответ:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df5 <span class="op">=</span> df.loc[df4]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df6 <span class="op">=</span> df5.loc[df5.iloc[::,<span class="dv">4</span>] <span class="op">==</span> df5.iloc[::,<span class="dv">4</span>].<span class="bu">min</span>()]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df7 <span class="op">=</span> <span class="bu">list</span>(df6.iloc[::,<span class="dv">3</span>])</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df8 <span class="op">=</span> <span class="bu">set</span>(df7)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>df9 <span class="op">=</span> <span class="bu">list</span>(df8)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>df10 <span class="op">=</span> []</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df9:</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> df7.count(i)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    df10.append(x)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>df11 <span class="op">=</span> DataFrame({<span class="st">&quot;first_num_port&quot;</span>:df9,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;counts&quot;</span>:df10})</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>df12 <span class="op">=</span> df11[df11[<span class="st">&quot;counts&quot;</span>] <span class="op">==</span> df11[<span class="st">&quot;counts&quot;</span>].<span class="bu">max</span>()]</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>df13 <span class="op">=</span> df6[df6.iloc[::,<span class="dv">3</span>] <span class="op">==</span> <span class="bu">list</span>(df12[<span class="st">&quot;first_num_port&quot;</span>])[<span class="dv">0</span>]]</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>df14 <span class="op">=</span> <span class="bu">list</span>(df13.iloc[::,<span class="dv">3</span>])[<span class="dv">0</span>]</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df14)</span></code></pre></div>
<pre><code>105</code></pre>
